"use strict";function sendMessage(e){e&&(console.log("global?",0===e.indexOf("/global")),0===e.indexOf("/global")?socket.emit("createGlobalMessage",{text:'<span class="green-text text-darken-4">[Global]</span>'+e.replace("/global","")},function(){}):socket.emit("createMessage",{text:e},function(){}))}var socket=io(),scrollToBottom=function(){var e=$("#messages"),t=e.children("li:last-child"),o=e.prop("clientHeight"),n=t.innerHeight(),a=t.prev().innerHeight(),s=e.prop("scrollTop"),c=e.prop("scrollHeight");o+s+n+a>=c&&e.scrollTop(c)};socket.on("connect",function(){var e=$.deparam(window.location.search);socket.emit("join",e,function(e){e&&(alert(e),window.location.href="/")})}),socket.on("disconnect",function(){console.log("Disconnected from server")}),socket.on("updateUserList",function(e){var t=$('<div class="collection"></div>');console.log("updating users",e),e.forEach(function(e){t.append('<a href="#" class="collection-item">'+e+"</a>")}),$("#users").html(t)}),socket.on("newMessage",function(e){var t=e.owner,o=e.text,n=e.createdAt,a="SocketBot"===t?"blue-text text-darken-1":"",s=new Date(n).toLocaleTimeString(),c=$('<li class="collection-item chat__message"></li>'),l='<span class="secondary-content message__date">'+s+"</span>",i='<p><strong class="'+a+'">'+t+" : </strong>"+l+"</p>",r="<p>"+o+"</p>";c.append(i).append(r),$("#messages").append(c),scrollToBottom()}),socket.on("newLocationMessage",function(e){var t=e.owner,o=e.url,n=e.createdAt,a="SocketBot"===t?"blue-text text-darken-1":"",s=new Date(n).toLocaleTimeString(),c=$('<li class="collection-item chat__message"></li>'),l='<span class="secondary-content message__date">'+s+"</span>",i='<p><strong class="'+a+'">'+t+" : </strong>"+l+"</p>",r=$('<a target="_blank">My current location</a>');r.attr("href",o),c.append(i).append(r),$("#messages").append(c),scrollToBottom()}),$(document).ready(function(){var e=function(e){e.preventDefault();var t=$("[name=message]");sendMessage(t.val()),t[0].value=""};$("#message-form").on("submit",e);var t=$("#send-location");t.on("click",function(e){if(e.preventDefault(),!navigator.geolocation)return Materialize.toast("Geolocation not supported by your browser",3e3,"orange");t.attr("disabled","disabled").text("Sending location..."),navigator.geolocation.getCurrentPosition(function(e){t.removeAttr("disabled").text("Send my location"),socket.emit("createLocationMessage",{latitude:e.coords.latitude,longitude:e.coords.longitude})},function(){t.removeAttr("disabled").text("Send my location"),Materialize.toast("Unable to fetch location",3e3,"yellow darken-3")})}),$("#messageArea").on("keypress",function(t){13===t.which&&e(t)})});